{% extends "layout.html" %}

{% block title %}My Bookmarks - News Management System{% endblock %}

{% block content %}
<div class="mb-8 slide-in-left flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
    <div>
        <h1 class="text-4xl font-bold text-gray-900 mb-4 flex items-center gap-3">
            <svg class="w-10 h-10 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
            </svg>
            My Bookmarks
        </h1>
        <p class="text-gray-600 text-lg">
            Your saved articles for quick access
        </p>
    </div>
    <div class="flex items-center gap-3">
        <span class="bg-yellow-100 text-yellow-800 text-sm px-4 py-2 rounded-full font-semibold">
            <span id="bookmarkCount">0</span> saved articles
        </span>
        <button 
            onclick="clearAllBookmarks()" 
            class="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition duration-200 inline-flex items-center gap-2"
        >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            Clear All
        </button>
    </div>
</div>

<!-- Notification Container -->
<div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

<!-- Bookmarked Articles Grid -->
<div id="bookmarksContainer">
    {% if articles %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
    {% for article in articles %}
        <div class="article-card-modern bg-white rounded-xl shadow-md overflow-hidden article-card-animate tile-interactive" 
             data-id="{{ article.id }}"
             data-title="{{ article.title|lower }}" 
             data-category="{{ article.category.name if article.category else ''|lower }}" 
             data-author="{{ article.author|lower if article.author else '' }}" 
             data-content="{{ article.content[:200]|lower }}">
            <div class="article-card-image relative">
                {% if article.image_url %}
                <div class="h-48 overflow-hidden">
                    <img 
                        src="{{ article.image_url }}" 
                        alt="{{ article.title }}"
                        class="w-full h-full object-cover"
                    >
                </div>
                {% else %}
                <div class="bg-gradient-to-r from-yellow-400 to-yellow-600 h-48 flex items-center justify-center">
                    <span class="text-6xl">üì∞</span>
                </div>
                {% endif %}
                <!-- Bookmark Indicator -->
                <div class="absolute top-3 right-3 bg-yellow-500 text-white text-xs px-3 py-1.5 rounded-full font-semibold shadow-sm flex items-center gap-1">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                    </svg>
                    Saved
                </div>
                {% if article.category %}
                <div class="absolute top-3 left-3 bg-indigo-100 text-indigo-800 text-xs px-3 py-1.5 rounded-full font-semibold shadow-sm">
                    {{ article.category.name }}
                </div>
                {% endif %}
            </div>
            
            <div class="p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2 hover:text-yellow-600 transition-colors">{{ article.title }}</h3>
                
                <p class="text-gray-600 text-sm mb-4 line-clamp-3">{{ article.content[:150] }}...</p>
                
                <div class="flex items-center justify-between text-sm text-gray-500 mb-4 flex-wrap gap-2">
                    {% if article.author %}
                    <span class="flex items-center space-x-1">
                        <span class="icon-bounce-hover">‚úçÔ∏è</span>
                        <span class="font-medium">{{ article.author }}</span>
                    </span>
                    {% else %}
                    <span class="flex items-center space-x-1">
                        <span>üìÖ</span>
                        <span>{{ article.created_at.strftime('%b %d, %Y') if article.created_at else 'Recently' }}</span>
                    </span>
                    {% endif %}
                    <span class="flex items-center space-x-1">
                        <span class="icon-scale-hover">üìÑ</span>
                        <span>Article</span>
                    </span>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-2">
                    <a 
                        href="/articles/{{ article.id }}" 
                        class="inline-flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-gray-700 transition duration-200 hover:scale-105 transform flex-1"
                    >
                        Read Article
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                        </svg>
                    </a>
                    <button 
                        onclick="toggleBookmark({{ article.id }})" 
                        class="inline-flex items-center justify-center gap-2 bg-yellow-500 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-yellow-600 transition duration-200 hover:scale-105 transform flex-1"
                        title="Remove bookmark"
                    >
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        Remove
                    </button>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="bg-gray-100 rounded-lg p-12 text-center">
        <div class="mb-6">
            <svg class="w-24 h-24 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 mb-4">No Bookmarks Yet</h2>
        <p class="text-gray-600 text-lg mb-6 max-w-md mx-auto">
            You haven't bookmarked any articles yet. Start exploring and save articles you want to read later!
        </p>
        <a 
            href="/articles" 
            class="bg-yellow-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-yellow-600 transition duration-200 inline-block"
        >
            Browse Articles
        </a>
    </div>
    {% endif %}
</div>

<!-- Confirmation Modal for Clear All -->
<div id="clearModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 max-w-md mx-4 transform transition-all scale-100">
        <div class="text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Clear All Bookmarks?</h3>
            <p class="text-gray-600 mb-6">
                This will remove all your saved articles. This action cannot be undone.
            </p>
            <div class="flex gap-3 justify-center">
                <button 
                    onclick="closeClearModal()" 
                    class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-semibold hover:bg-gray-400 transition duration-200"
                >
                    Cancel
                </button>
                <button 
                    onclick="confirmClearBookmarks()" 
                    class="bg-red-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-600 transition duration-200"
                >
                    Clear All
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/state.js') }}"></script>
<script>
// Initialize bookmarks on page load
document.addEventListener('DOMContentLoaded', function() {
    // Update bookmark count
    updateBookmarkCount();
    
    // Remove articles that are no longer bookmarked
    filterVisibleBookmarks();
});

// Update the bookmark count display
function updateBookmarkCount() {
    var count = Store.getBookmarkCount();
    var countEl = document.getElementById('bookmarkCount');
    if (countEl) {
        countEl.textContent = count;
    }
}

// Filter to show only currently bookmarked articles
function filterVisibleBookmarks() {
    var articleCards = document.querySelectorAll('.article-card-modern');
    articleCards.forEach(function(card) {
        var articleId = card.getAttribute('data-id');
        if (!Store.isBookmarked(articleId)) {
            card.style.display = 'none';
        }
    });
}

// Toggle bookmark for an article
function toggleBookmark(articleId) {
    var isNowBookmarked = Store.toggleBookmark(articleId);
    
    if (!isNowBookmarked) {
        // Remove the card from view with animation
        var card = document.querySelector('.article-card-modern[data-id="' + articleId + '"]');
        if (card) {
            card.style.opacity = '0';
            card.style.transform = 'scale(0.9)';
            card.style.transition = 'all 0.3s ease';
            setTimeout(function() {
                card.style.display = 'none';
                checkEmptyState();
                updateBookmarkCount();
            }, 300);
        }
    }
}

// Check if no bookmarks are visible and show empty state
function checkEmptyState() {
    var cards = document.querySelectorAll('.article-card-modern:not([style*="display: none"])');
    var container = document.getElementById('bookmarksContainer');
    
    if (cards.length === 0 && container) {
        var emptyHTML = '<div class="bg-gray-100 rounded-lg p-12 text-center">' +
            '<div class="mb-6">' +
            '<svg class="w-24 h-24 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>' +
            '</svg>' +
            '</div>' +
            '<h2 class="text-2xl font-bold text-gray-900 mb-4">No Bookmarks Left</h2>' +
            '<p class="text-gray-600 text-lg mb-6 max-w-md mx-auto">' +
            "You've removed all your bookmarks. Start exploring and save articles you want to read later!" +
            '</p>' +
            '<a href="/articles" class="bg-yellow-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-yellow-600 transition duration-200 inline-block">' +
            'Browse Articles' +
            '</a>' +
            '</div>';
        container.innerHTML = emptyHTML;
    }
}

// Show clear confirmation modal
function clearAllBookmarks() {
    var modal = document.getElementById('clearModal');
    if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }
}

// Close clear confirmation modal
function closeClearModal() {
    var modal = document.getElementById('clearModal');
    if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }
}

// Confirm and clear all bookmarks
function confirmClearBookmarks() {
    Store.clearBookmarks();
    closeClearModal();
    
    // Show empty state
    var container = document.getElementById('bookmarksContainer');
    if (container) {
        var emptyHTML = '<div class="bg-gray-100 rounded-lg p-12 text-center">' +
            '<div class="mb-6">' +
            '<svg class="w-24 h-24 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>' +
            '</svg>' +
            '</div>' +
            '<h2 class="text-2xl font-bold text-gray-900 mb-4">No Bookmarks</h2>' +
            '<p class="text-gray-600 text-lg mb-6 max-w-md mx-auto">' +
            'All bookmarks have been cleared. Start exploring and save articles you want to read later!' +
            '</p>' +
            '<a href="/articles" class="bg-yellow-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-yellow-600 transition duration-200 inline-block">' +
            'Browse Articles' +
            '</a>' +
            '</div>';
        container.innerHTML = emptyHTML;
    }
    updateBookmarkCount();
}
</script>
{% endblock %}

